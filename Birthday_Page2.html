<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cuốn Sách Sinh Nhật</title>
    <!-- Thay link Google Fonts sang Roboto -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
<!-- Thêm Google Fonts Lobster cho trang bìa -->
<link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(120deg, #e0c3a3 0%, #fffbe6 100%);
            min-height: 100vh;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .book-container {
            perspective: 1800px;
            width: 600px;
            max-width: 95vw;
            height: 400px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .book {
            width: 600px;
            max-width: 95vw;
            height: 400px;
            position: relative;
            border-radius: 32px;
            box-shadow: 0 12px 48px #bfae8f, 0 0 0 12px #a67c52;
            background: #fffbe6;
            display: flex;
            overflow: hidden;
        }
        .book-side {
            width: 32px;
            height: 100%;
            background: linear-gradient(90deg, #7c4a02 60%, #a67c52 100%);
            box-shadow: 0 0 16px #a67c52 inset;
            border-radius: 32px 0 0 32px;
            position: absolute;
            left: 0;
            top: 0;
            z-index: 2;
        }
        .book-side.right {
            left: auto;
            right: 0;
            border-radius: 0 32px 32px 0;
            background: linear-gradient(270deg, #7c4a02 60%, #a67c52 100%);
        }
        .book-pages {
            flex: 1;
            height: 100%;
            position: relative;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(120deg, #fffbe6 60%, #e0c3a3 100%);
            box-shadow: 0 0 32px #fffbe6 inset;
        }
        .book-pages::before {
            content: "";
            position: absolute;
            left: 0; top: 0;
            width: 100%; height: 100%;
            border-radius: 0 0 32px 32px;
            box-shadow: 0 0 80px 0 #fffbe6 inset, 0 0 32px #e0c3a3 inset;
            pointer-events: none;
        }
        .cake-area {
            position: relative;
            width: 260px;
            max-width: 60%;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .cake-img {
            width: 180px;
            max-width: 100%;
            margin-bottom: 18px;
            filter: drop-shadow(0 0 24px #fffbe6) drop-shadow(0 0 8px #e573b7);
        }
        .cake-text {
            text-align: center;
            font-family: 'Pacifico', 'Baloo', 'Fredoka One', cursive;
            font-size: 2em;
            color: #b721ff;
            text-shadow: 0 0 12px #fffbe6, 0 0 4px #b721ff;
            font-weight: bold;
            margin-bottom: 6px;
        }
        .cake-date {
            text-align: center;
            font-family: 'Baloo', 'Fredoka One', cursive;
            font-size: 1.2em;
            color: #e573b7;
            text-shadow: 0 0 8px #fffbe6, 0 0 2px #e573b7;
            font-weight: 500;
        }
        /* Animation: Flip pages */
        .book-flip {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%) rotateY(0deg);
            width: 600px;
            max-width: 95vw;
            height: 400px;
            border-radius: 32px;
            background: #fffbe6;
            box-shadow: 0 12px 48px #bfae8f, 0 0 0 12px #a67c52;
            z-index: 10;
            overflow: hidden;
            animation: flipBook 1.2s cubic-bezier(.7,.2,.3,1) 0s 1;
        }
        @keyframes flipBook {
            0% { transform: translate(-50%, -50%) rotateY(0deg) scaleX(1.1); opacity: 1; }
            60% { transform: translate(-50%, -50%) rotateY(720deg) scaleX(0.7); opacity: 1; }
            100% { transform: translate(-50%, -50%) rotateY(0deg) scaleX(1); opacity: 0; }
        }
        .book-flip-pages {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            max-width: 95vw;
            height: 400px;
            z-index: 20;
            pointer-events: none;
        }
        .flip-page {
            position: absolute;
            width: 600px;
            max-width: 95vw;
            height: 400px;
            background: #fffbe6;
            border-radius: 32px;
            box-shadow: 0 12px 48px #bfae8f, 0 0 0 12px #a67c52;
            left: 0;
            top: 0;
            transform: rotateY(0deg);
            transition: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .cover-page {
            background: #7c4a02;
            border-radius: 32px;
            width: 600px;
            max-width: 95vw;
            font-family: 'Pacifico', 'Baloo', 'Fredoka One', cursive !important;
        }
        .half-book {
            display: none;
        }
        .middle-page {
            background: linear-gradient(120deg, #fffbe6 60%, #e0c3a3 100%);
        }
        .page-inner-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100%;
        }
        .page-inner-content img {
          width: 150px !important;
          max-width: 90vw !important;
          border-radius: 18px !important;
          box-shadow: 0 0 24px #fffbe6, 0 0 12px #b721ff !important;
        }
        @media (max-width: 700px) {
          .page-inner-content img {
            width: 30vw !important;
            max-width: 98vw !important;
          }
        }
        @media (max-width: 700px) {
            body {
              min-height: 100vh;
              padding: 0;
              font-size: 15px;
              overflow-x: hidden;
            }
            .book-container, .book, .book-flip, .book-flip-pages {
              width: 98vw !important;
              height: 60vw !important;
              min-height: 260px !important;
              max-width: 98vw !important;
            }
            .flip-page, .cover-page {
              width: 98vw !important;
              height: 60vw !important;
              min-height: 260px !important;
              max-width: 98vw !important;
            }
            .cake-area {
              width: 90vw !important;
              max-width: 98vw !important;
            }
            .cake-img {
              width: 60vw !important;
              max-width: 98vw !important;
            }
            .cake3d-container {
              width: 98vw !important;
              min-height: 220px !important;
            }
            .cake3d {
              width: 98vw !important;
              height: 60vw !important;
              min-height: 220px !important;
            }
            .cake3d-base { width: 70vw !important; height: 18vw !important; }
            .cake3d-mid { width: 48vw !important; height: 14vw !important; bottom: 16vw !important; }
            .cake3d-top { width: 28vw !important; height: 8vw !important; bottom: 28vw !important; }
            .cake3d-cream { width: 32vw !important; height: 4vw !important; bottom: 26vw !important; }
            .cake3d-flower, .cake3d-fruit { width: 6vw !important; height: 6vw !important; }
            .cake3d-candle { width: 2vw !important; height: 6vw !important; }
            .cake3d-flame { width: 4vw !important; height: 4vw !important; bottom: 34vw !important; }
            .corner-gif { width: 48px !important; top: 8px !important; }
            .left-corner { left: 4px !important; }
            .right-corner { right: 4px !important; }
            .page-inner-content {
              font-size: 1.1em !important;
              padding: 0 2vw !important;
            }
            .page-btn {
              font-size: 1em !important;
              padding: 8px 12px !important;
            }
        }
        .corner-gif.left-corner { left:12px !important; top:12px !important; }
.corner-gif.right-corner { right:12px !important; top:12px !important; }
.corner-gif { position:fixed !important; width:180px !important; height:auto !important; z-index:1000 !important; pointer-events:none; }
@media (max-width:700px) {
  .corner-gif { width:120px !important; top:4px !important; }
  .corner-gif.left-corner { left:4px !important; }
  .corner-gif.right-corner { right:4px !important; }
}
.cover-next-btn {
  position: absolute !important;
  top: 0 !important;
  right: 0 !important;
  margin: 18px 18px 0 0 !important;
  z-index: 100 !important;
}
.birthday-modal { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.4); z-index: 999; justify-content: center; align-items: center; }
.birthday-modal.show { display: flex !important; }
.birthday-modal-content { background: #fffbe6; padding: 32px 24px; border-radius: 18px; box-shadow: 0 8px 32px #f7b7b7; max-width: 90vw; text-align: center; }
html, body, .book, .book-pages, .flip-page, .page-inner-content, .cake-area, .cake-info-left, .cake-info-right, .page-btn, .birthday-modal-content, * {
  font-family: 'Roboto', Arial, sans-serif !important;
}
.page-btn {
  background: linear-gradient(120deg, #ffe6f7 60%, #fffbe6 100%);
  color: #f67280;
  border: none;
  border-radius: 18px;
  box-shadow: 0 4px 16px #f7b7b7, 0 0 0 2px #ffe6f7;
  font-size: 1.2em;
  font-family: 'Baloo', 'Fredoka One', cursive;
  font-weight: bold;
  padding: 12px 28px;
  margin: 0 8px;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
  display: flex;
  align-items: center;
  gap: 8px;
}
.page-btn.left-btn::before {
  content: '🍰';
  font-size: 1.3em;
}
.page-btn.right-btn::after {
  content: '🎈';
  font-size: 1.3em;
}
.page-btn:hover {
  background: linear-gradient(120deg, #fffbe6 60%, #ffe6f7 100%);
  color: #e573b7;
  transform: scale(1.08);
  box-shadow: 0 8px 24px #f7b7b7, 0 0 0 4px #ffe6f7;
}
/* Confetti effect */
.confetti {
  position: fixed;
  left: 0; top: 0;
  width: 100vw;
  height: 100vh;
  pointer-events: none;
  z-index: 9999;
}
.cover-page * {
  font-family: 'Lobster', cursive !important;
}
    </style>
</head>
<body>
    <img src="Gaubong5.gif" alt="Trang trí trái" class="corner-gif left-corner" style="position:fixed;top:12px;left:12px;width: 200px;height:auto;z-index:1000;">
    <img src="Gaubong6.gif" alt="Trang trí phải" class="corner-gif right-corner" style="position:fixed;top:12px;right:12px;width:200px;height:auto;z-index:1000;">
    <div class="book-container">
        <div class="book-flip-pages" id="bookFlipPages"></div>
        <div class="book" id="mainBook" style="opacity:0;">
            <div class="book-side"></div>
            <div class="book-pages" id="bookPages"></div>
            <div class="book-side right"></div>
        </div>
    </div>
    <script>
        // Sách có 7 trang: 0 (bìa), 1-5 (chữ + ảnh), 6 (bánh kem)
        const NUM_PAGES = 7;
        const flipContainer = document.getElementById('bookFlipPages');
        const mainBook = document.getElementById('mainBook');
        let currentPage = 0;
        // Nội dung từng trang
        const pageContents = [
            {}, // Trang bìa
            {
                text: 'Chúc mừng sinh nhật!',
                img: 'HappyBirthDay.png'
            },
            {
                text: 'Tuổi mới, nhiều niềm vui mới, thành công mới và hạnh phúc mới.',
                img: 'Birthday_1.jpg'
            },
            {
                text: 'Happy Birthday! Chúc cô luôn bình an, may mắn và tràn đầy năng lượng.',
                img: 'Birthday_2.png'
            },
            {
                text: 'Luôn thành công và rực rỡ nhé!',
                img: 'Birthday_3.jpg'
            },
            {
                text: 'Chúc chị thêm một tuổi mới đầy yêu thương, tiếng cười và kỷ niệm đẹp.',
                img: 'Birthday_4.png'
            },
            {
                cake: true,
                name: 'Nguyễn Văn A',
                date: '01/01/2000',
                img: 'Birthday/HappyBirthDay.png'
            }
        ];
        function createFlipPages() {
            flipContainer.innerHTML = '';
            for(let i=0; i<NUM_PAGES; i++) {
                const page = document.createElement('div');
                page.className = 'flip-page';
                page.style.zIndex = NUM_PAGES - i;
                page.style.left = '0';
                page.dataset.pageIndex = i;
                if(i === 0) {
                    page.classList.add('cover-page');
                    // Thêm title Happy birthday vào trang bìa
                    const title = document.createElement('div');
                    title.style.position = 'absolute';
                    title.style.top = '50%';
                    title.style.left = '50%';
                    title.style.transform = 'translate(-50%, -50%)';
                    title.style.fontSize = '2.8em';
                    title.style.fontFamily = "'Lobster', cursive";
                    title.style.color = '#fffbe6';
                    title.style.textShadow = '0 0 18px #e573b7, 0 0 8px #b721ff';
                    title.style.fontWeight = 'bold';
                    title.style.textAlign = 'center';
                    title.innerHTML = 'Happy Birthday<br><span style="font-size:1.3em;color:#ff65a3;text-shadow:0 0 8px #fffbe6;">Ín Nhiii</span>';
                    page.appendChild(title);
                }
                // Nội dung từng trang
                if(i > 0 && i < NUM_PAGES-1) {
                    const content = document.createElement('div');
                    content.className = 'page-inner-content';
                    content.style.position = 'absolute';
                    content.style.top = '50%';
                    content.style.left = '50%';
                    content.style.transform = 'translate(-50%, -50%)';
                    content.style.textAlign = 'center';
                    content.style.fontSize = '1.6em';
                    content.style.color = '#b721ff';
                    content.style.display = 'flex';
                    content.style.flexDirection = 'column';
                    content.style.alignItems = 'center';
                    content.style.justifyContent = 'center';
                    if(pageContents[i].text) {
                        const text = document.createElement('div');
                        text.textContent = pageContents[i].text;
                        text.style.marginBottom = '18px';
                        text.style.fontWeight = 'bold';
                        text.style.fontFamily = "'Baloo', 'Fredoka One', cursive";
                        content.appendChild(text);
                    }
                    if(pageContents[i].img) {
                        const img = document.createElement('img');
                        img.src = pageContents[i].img;
                        img.alt = 'Ảnh';
                        img.style.width = '120px';
                        img.style.maxWidth = '60%';
                        img.style.borderRadius = '16px';
                        img.style.boxShadow = '0 0 18px #fffbe6, 0 0 8px #b721ff';
                        img.style.margin = '0 auto';
                        content.appendChild(img);
                    }
                    page.appendChild(content);
                }
                // Trang cuối là bánh kem đám cưới thật to, vượt qua cuốn sách
                if(i === NUM_PAGES-1) {
                    // Trang cuối: bánh kem 3D 3 tầng, 3 cây nến cách đều nhau, ngọn lửa lung linh
                    const cake = document.createElement('div');
                    cake.className = 'cake-area';
                    cake.style.display = 'flex';
                    cake.style.flexDirection = 'column';
                    cake.style.alignItems = 'center';
                    cake.style.justifyContent = 'center';
                    cake.style.width = '100%';
                    cake.style.margin = '0 auto';
                    cake.innerHTML = `
                    <div class="cake-info-left" style="position:absolute;top:44vw;left:33vw;z-index:30;max-width:30vw;width:30vw;text-align:left;padding-left:2vw;font-size:2rem;color:#b721ff;font-family:'Baloo','Fredoka One',cursive;word-break:break-word;">Trần Thị Yến Nhi</div>
                    <div class="cake-reminder" style="position:absolute;top:3vw;left:50%;transform:translateX(-50%);z-index:40;font-size:1rem;color:#ff65a3;font-family:'Baloo','Fredoka One',cursive;text-shadow:0 0 12px #fffbe6,0 0 4px #b721ff;font-weight:bold;letter-spacing:2px;">Ước đi rồi thổi nến 🎂</div>
                    <div class="cake-info-right" style="position:absolute;top:35vw;right:29vw;z-index:30;max-width:30vw;width:30vw;text-align:right;padding-right:2vw;font-size:1.6rem;color:#e573b7;font-family:'Baloo','Fredoka One',cursive;word-break:break-word;">10/09/2002</div>
                    <div class="cake3d-container" style="position:relative;width:80vw;max-width:340px;height:80vw;max-height:340px;margin-top:-10vw;">
                      <div class="cake-base" style="position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:65vw;max-width=260px;height:18vw;max-height:70px;background:linear-gradient(120deg,#fffbe6 60%,#ffe6f7 100%);border-radius:0 0 20vw 20vw/0 0 14vw 14vw;box-shadow:0 1vw 4vw #f7b7b7,0 0 0 2vw #f7b7b7;z-index:1;"></div>
                      <div class="cake-mid" style="position:absolute;bottom:15vw;left:50%;transform:translateX(-50%);width:45vw;max-width=180px;height:14vw;max-height:60px;background:linear-gradient(120deg,#ffe6f7 60%,#fffbe6 100%);border-radius:0 0 14vw 14vw/0 0 9vw 9vw;box-shadow:0 0.5vw 2vw #f67280,0 0 0 1vw #f67280;z-index:2;"></div>
                      <div class="cake-top" style="position:absolute;bottom:28vw;left:50%;transform:translateX(-50%);width:28vw;max-width=110px;height:5vw;max-height:38px;background:linear-gradient(120deg,#fffbe6 60%,#ffe066 100%);border-radius:0 0 8vw 8vw/0 0 5vw 5vw;box-shadow:0 0.2vw 1vw #ffe066,0 0 0 0.5vw #ffe066;z-index:3;"></div>
                      <div class="cake-cream" style="position:absolute;left:50%;transform:translateX(-50%);bottom:26vw;width:12vw;max-width:120px;height:2vw;max-height:18px;background:radial-gradient(circle at 2vw 1vw,#fff 60%,#ffe6f7 100%);border-radius:2vw/1.2vw;z-index:4;box-shadow:0 0.2vw 0.8vw #fffbe6;"></div>
                      <div class="cake-candle candle1" style="position:absolute;width:2vw;max-width=10px;height:6vw;max-height=32px;left:calc(50% - 10vw);bottom:32vw;background:linear-gradient(120deg,#ffe066 60%,#ff65a3 100%);border-radius:1vw;z-index:10;"></div>
                      <div class="cake-candle candle2" style="position:absolute;width:2vw;max-width=10px;height:6vw;max-height=32px;left:50%;bottom:32vw;background:linear-gradient(120deg,#ffe066 60%,#ff65a3 100%);border-radius:1vw;transform:translateX(-50%);z-index:10;"></div>
                      <div class="cake-candle candle3" style="position:absolute;width:2vw;max-width=10px;height:6vw;max-height=32px;left:calc(50% + 10vw);bottom:32vw;background:linear-gradient(120deg,#ffe066 60%,#ff65a3 100%);border-radius:1vw;z-index:10;"></div>
                      <div class="candle-flame flame1" style="position:absolute;left:calc(50% - 10vw);bottom:38vw;width:4vw;max-width=18px;height:4vw;max-height:18px;z-index:11;cursor:pointer;animation:flameTwinkle 0.7s infinite alternate;"><div class="flame-inner" style="width:100%;height:100%;border-radius:50% 50% 60% 60%/60% 60% 100% 100%;background:radial-gradient(circle at 60% 40%,#fffbe6 40%,#ffe066 70%,#ff9800 100%);box-shadow:0 0 4vw 1vw #ffe066,0 0 2vw 0.5vw #ff9800;"></div></div>
                      <div class="candle-flame flame2" style="position:absolute;left:50%;bottom:38vw;width:4vw;max-width=18px;height:4vw;max-height:18px;transform:translateX(-50%);z-index:11;cursor:pointer;animation:flameTwinkle 0.7s infinite alternate;"><div class="flame-inner" style="width:100%;height:100%;border-radius:50% 50% 60% 60%/60% 60% 100% 100%;background:radial-gradient(circle at 60% 40%,#fffbe6 40%,#ffe066 70%,#ff9800 100%);box-shadow:0 0 4vw 1vw #ffe066,0 0 2vw 0.5vw #ff9800;"></div></div>
                      <div class="candle-flame flame3" style="position:absolute;left:calc(50% + 10vw);bottom:38vw;width:4vw;max-width=18px;height:4vw;max-height:18px;z-index:11;cursor:pointer;animation:flameTwinkle 0.7s infinite alternate;"><div class="flame-inner" style="width:100%;height:100%;border-radius:50% 50% 60% 60%/60% 60% 100% 100%;background:radial-gradient(circle at 60% 40%,#fffbe6 40%,#ffe066 70%,#ff9800 100%);box-shadow:0 0 4vw 1vw #ffe066,0 0 2vw 0.5vw #ff9800;"></div></div>
                    </div>
                     <button id="birthdayBtn" style="display:none;position:absolute;top:-56px;left:50%;transform:translateX(-50%);background:#f67280;color:#fffbe6;border:none;border-radius:12px;padding:12px 32px;box-shadow:0 4px 16px #f7b7b7;z-index:20;font-size:1.2rem;font-weight:bold;cursor:pointer;">🎉Lẹ lẹ đi, món quà cuối nè 🎂</button>
                    <style>
                    @keyframes flameTwinkle {
                      0% { transform: scaleY(1) scaleX(1); filter: blur(0px); }
                      100% { transform: scaleY(1.15) scaleX(0.95); filter: blur(2px); }
                    }
                    </style>
                    `;
                    page.appendChild(cake);
                }
                flipContainer.appendChild(page);
            }
            // Thêm nút đi tiếp vào .book khi ở trang bìa
            const book = document.getElementById('mainBook');
            let nextBtn = document.getElementById('coverNextBtn');
            if (nextBtn) nextBtn.remove();
            if (currentPage === 0) {
                nextBtn = document.createElement('button');
                nextBtn.id = 'coverNextBtn';
                nextBtn.className = 'page-btn right-btn';
                nextBtn.textContent = 'Lật tiếp ▶';
                nextBtn.style.position = 'absolute';
                nextBtn.style.top = '0';
                nextBtn.style.right = '0';
                nextBtn.style.margin = '4px 8px 0 0';
                nextBtn.style.zIndex = '2000';
                nextBtn.onclick = (e) => { e.stopPropagation(); currentPage = 1; updatePageVisibility(); };
                book.appendChild(nextBtn);
            }
        }
        createFlipPages();
        function showBook() {
            flipContainer.style.display = 'block';
            mainBook.style.opacity = '1';
            updatePageVisibility();
          }
        function updatePageVisibility() {
            const pages = flipContainer.children;
            for(let i=0; i<NUM_PAGES; i++) {
                // Flip effect
                if(i < currentPage) {
                    pages[i].style.transform = 'rotateY(-180deg)';
                    pages[i].style.transition = 'transform 0.4s cubic-bezier(.7,.2,.3,1)';
                    pages[i].style.zIndex = NUM_PAGES - i;
                    pages[i].style.pointerEvents = 'none';
                } else if(i === currentPage) {
                    pages[i].style.transform = 'rotateY(0deg)';
                    pages[i].style.transition = 'transform 0.4s cubic-bezier(.7,.2,.3,1)';
                    pages[i].style.zIndex = NUM_PAGES + 2; // Trang hiện tại nổi nhất
                    pages[i].style.pointerEvents = 'auto';
                } else {
                    pages[i].style.transform = 'rotateY(0deg)';
                    pages[i].style.transition = 'transform 0.4s cubic-bezier(.7,.2,.3,1)';
                    pages[i].style.zIndex = NUM_PAGES - i;
                    pages[i].style.pointerEvents = 'none';
                }
                // Remove old nav buttons
                const oldBtns = pages[i].querySelectorAll('.page-btn');
                oldBtns.forEach(btn => btn.remove());
            }
            const book = document.getElementById('mainBook');
            // Xóa nút cũ
            let prevBtn = document.getElementById('coverPrevBtn');
            if (prevBtn) prevBtn.remove();
            let nextBtn = document.getElementById('coverNextBtn');
            if (nextBtn) nextBtn.remove();
            // Trang bìa chỉ có nút lật tiếp
            if (currentPage === 0) {
                nextBtn = document.createElement('button');
                nextBtn.id = 'coverNextBtn';
                nextBtn.className = 'page-btn right-btn';
                nextBtn.textContent = 'Lật tiếp ▶';
                nextBtn.style.position = 'absolute';
                nextBtn.style.top = '0';
                nextBtn.style.right = '0';
                nextBtn.style.margin = '4px 8px 0 0';
                nextBtn.style.zIndex = '2000';
                nextBtn.onclick = (e) => { e.stopPropagation(); currentPage = 1; updatePageVisibility(); };
                book.appendChild(nextBtn);
            }
            // Các trang giữa (1-5) có cả nút lật lùi và lật tiếp
            else if (currentPage > 0 && currentPage < NUM_PAGES-1) {
                prevBtn = document.createElement('button');
                prevBtn.id = 'coverPrevBtn';
                prevBtn.className = 'page-btn left-btn';
                prevBtn.textContent = '◀ Lật lùi';
                prevBtn.style.position = 'absolute';
                prevBtn.style.top = '0';
                prevBtn.style.left = '0';
                prevBtn.style.margin = '4px 0 0 8px';
                prevBtn.style.zIndex = '2000';
                prevBtn.onclick = (e) => { e.stopPropagation(); currentPage--; updatePageVisibility(); };
                book.appendChild(prevBtn);
                nextBtn = document.createElement('button');
                nextBtn.id = 'coverNextBtn';
                nextBtn.className = 'page-btn right-btn';
                nextBtn.textContent = 'Lật tiếp ▶';
                nextBtn.style.position = 'absolute';
                nextBtn.style.top = '0';
                nextBtn.style.right = '0';
                nextBtn.style.margin = '4px 8px 0 0';
                nextBtn.style.zIndex = '2000';
                nextBtn.onclick = (e) => { e.stopPropagation(); currentPage++; updatePageVisibility(); };
                book.appendChild(nextBtn);
            }
            // Trang cuối chỉ có nút lật lùi
            else if (currentPage === NUM_PAGES-1) {
                prevBtn = document.createElement('button');
                prevBtn.id = 'coverPrevBtn';
                prevBtn.className = 'page-btn left-btn';
                prevBtn.textContent = '◀ Lật lùi';
                prevBtn.style.position = 'absolute';
                prevBtn.style.top = '0';
                prevBtn.style.left = '0';
                prevBtn.style.margin = '4px 0 0 8px';
                prevBtn.style.zIndex = '2000';
                prevBtn.onclick = (e) => {
                    e.stopPropagation();
                    // Nếu đã thổi hết nến thì reset lại trạng thái nến, ẩn nút chúc mừng, tắt confetti
                    if (typeof window.resetCakeState === 'function') window.resetCakeState();
                    currentPage--;
                    updatePageVisibility();
                };
                book.appendChild(prevBtn);
            }
            // Trong updatePageVisibility(), sau khi xác định trang hiện tại là trang cuối, luôn gọi resetCakeState trước khi initCake3D
            if(currentPage === NUM_PAGES-1) {
              window.resetCakeState && window.resetCakeState();
              setTimeout(initCake3D, 50);
            }
            for(let j=0; j<NUM_PAGES; j++) {
              const flames = pages[j].querySelectorAll('.cake3d-flame');
              flames.forEach(f => {
                f.style.pointerEvents = (j === currentPage && j === NUM_PAGES-1) ? 'auto' : 'none';
              });
            }
        }
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                showBook();
            }, 600);
        });
        // Sửa lại initCake3D để luôn gán lại eventListener và trạng thái nến mỗi lần vào trang cuối
function initCake3D() {
  const flames = document.querySelectorAll('.candle-flame');
  window.flameStates = [true, true, true];
  flames.forEach((flame, idx) => {
    flame.style.opacity = '1'; // reset lại ngọn lửa
    // Xóa event cũ
    flame.replaceWith(flame.cloneNode(true));
  });
  // Lấy lại node sau khi clone
  const newFlames = document.querySelectorAll('.candle-flame');
  newFlames.forEach((flame, idx) => {
    flame.addEventListener('click', function() {
      flame.style.opacity = '0.2';
      window.flameStates[idx] = false;
      checkAllFlames();
    });
  });
  // Ẩn nút chúc mừng
  const btn = document.getElementById('birthdayBtn');
  if(btn) btn.style.display = 'none';
  // Tắt confetti nếu còn
  const confettiCanvas = document.getElementById('confettiCanvas');
  if(confettiCanvas) confettiCanvas.remove();
}
        function showConfetti() {
  if(document.getElementById('confettiCanvas')) return;
  const canvas = document.createElement('canvas');
  canvas.id = 'confettiCanvas';
  canvas.className = 'confetti';
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  document.body.appendChild(canvas);
  const ctx = canvas.getContext('2d');
  const confettiCount = 180;
  const confetti = [];
  for(let i=0;i<confettiCount;i++) {
    confetti.push({
      x: Math.random()*canvas.width,
      y: Math.random()*-canvas.height,
      r: 6+Math.random()*10,
      d: Math.random()*canvas.height,
      color: `hsl(${Math.random()*360},90%,70%)`,
      tilt: Math.random()*10,
      tiltAngle: Math.random()*Math.PI*2,
      speed: 0.9+Math.random()*1.2 // tốc độ rơi chậm hơn
    });
  }
  let running = true;
  function drawConfetti() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    confetti.forEach(c => {
      ctx.save();
      ctx.beginPath();
      ctx.arc(c.x, c.y, c.r, 0, 2*Math.PI);
      ctx.fillStyle = c.color;
      ctx.globalAlpha = 0.85;
      ctx.fill();
      ctx.restore();
    });
  }
  function updateConfetti() {
    confetti.forEach(c => {
      c.y += c.speed;
      c.x += Math.sin(c.tiltAngle)*2;
      c.tiltAngle += 0.05;
      if(c.y > canvas.height+20) {
        c.y = Math.random()*-40;
        c.x = Math.random()*canvas.width;
      }
    });
  }
  function loop() {
    if(!running) return;
    drawConfetti();
    updateConfetti();
    requestAnimationFrame(loop);
  }
  loop();
  // Khi ấn nút chúc mừng sinh nhật thì tắt confetti
  const btn = document.getElementById('birthdayBtn');
  if(btn) {
    btn.addEventListener('click', function() {
      running = false;
      canvas.remove();
    });
  }
}
        function checkAllFlames() {
  if(window.flameStates.every(f => !f)) {
    showConfetti();
    const btn = document.getElementById('birthdayBtn');
    if(btn) {
      btn.style.display = 'block';
      btn.onclick = function() {
        window.location.href = 'https://beta-crypto.github.io/Birthday_Page3/Birthday_Page3.html';
      };
    }
  }
}
        const closeBtn = document.getElementById('closeBirthdayModal');
        if(closeBtn) {
        closeBtn.addEventListener('click', function() {
            document.getElementById('birthdayModal').classList.remove('show');
        });
        }   
    </script>
</body>
</html>

